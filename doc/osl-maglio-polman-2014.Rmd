---
title: "Open Stats Lab Factorial ANOVA in R Using Data from Maglio & Polman (2014)"
author: "Cory J. Cascalheira"
date: "November 26, 2018"
output:
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "~/GitHub/osl-maglio-polman-2014/src")
```

# Open Stats Lab
___
Kevin P. McIntyre developed this amazing resource for students of psychology. Check out [Open Stats Lab](https://sites.trinity.edu/osl/) for a collection of all activities.

Each activity includes an article from *Psychological Science*, a data set, and an activity to complete in SPSS. However, if you are an open source fanatic, you could also complete the activity in [JASP](https://jasp-stats.org/). For tips on how to use JASP, check out [this resource](https://osf.io/t56kg/) created by Buchanan, Hopke, and Donaldson (2018).

I prefer to get my hands deep into the data. Dr. McIntyre does not *yet* offer an R activity to accompany the work of [Maglio and Polman (2014)](https://journals.sagepub.com/doi/pdf/10.1177/0956797614530571), so here is one possible solution written in R.

# Analysis
___
I will perform assumption checks for each test prior to running it. We already know that the data meet all assumptions, otherwise the authors would have used a different analytic approach. However, checking the assumptions is helpful because:

1. reproducibility and accuracy can be verified; and
2. if you are a student, then you should form the habit of testing assumptions.

This analysis will follow the data science workflow advocated by [Garrett Grolemund and Hadley Wickham](https://r4ds.had.co.nz/introduction.html). First, we will set-up our session and import the data. Then, we must clean the data. Next, we will transform, model, and visualize the data to understand it. Finally, we will communicate our findings.

## Import
___
Setting up the workspace involves loading packages and importing the data.

```{r message=FALSE}
library(tidyverse)
library(car)
```

A relative path is used because the working directory is set.

```{r message=FALSE}
maglio <- read_csv("../data/Maglio and Polman 2014 Experiment 1.csv")
```

## Clean
___
Coding clarity is important since we did not design the study. Which integer of the `station` variable correponds to Spadina, St. George, Bloor-Yonge, and Sherbourne? It is reasonable to think that the assignment of integers reads from left to right based on the Green Line map (see activity description).

Calculation of the means enables verification of this assumption. Count is included to understand the grouping of participants better. We can compare our average subjective distance to the numbers reported in [Figure 1](https://journals.sagepub.com/doi/pdf/10.1177/0956797614530571).

```{r}
maglio %>%
  group_by(direction, station) %>%
  summarize(mean = mean(subjective_distance), count = n())
```

The assumption held true: 1 corresponds to Spadina, 2 to St. George, and so on.

Notice that the sample sizes in each **cell** are unequal. That is, the number of participants within each level combination of factors (i.e., Spadina East, Spadina West, etc.) varies. Four cells have 26 participants, three cells have 25 participants, and 1 cell has 23 participants. 

Uneven sample sizes across cells creates an **unbalanced design**. This will affect the code we write to analyze these data.

But let's not get ahead of ourselves. First, we must code these integers to transform `station` into a factor. Might as well transform `direction` and `orientation` into factors in the same call. The purpose of these transformations is to meet a requriement of factorial ANOVA: categorical predictors that are factors with two or more levels.

```{r}
maglio_clean <- within(maglio, {
  station <- factor(station, labels = c("spadina", "st_george", "bloor_yonge", "sherbourne"))
  direction <- factor(direction)
  orientation <- factor(orientation, labels = c("towards", "away"))
})
```

## Understand
___
A factorial ANOVA compares the means across two or more independent variables, thereby splitting the sample into four or more groups. Contrast this with a one-way ANOVA, which only has one independent variable that splits the sample into two or more groups. In terms of analyzing variance, if we have more than one independent variable, then conduct a factorial ANOVA. Notice that, in both cases, we only have *one* dependent variable.

The presence of two independent variables classifies a factorial ANOVA as two-way. The assumptions of a two-way ANOVA echo those of the one-way ANOVA. Three are met before data collection, three are tested.

**Assumptions Before Data Collection**

1. **Two or more categorical independent variables** as factors with two or more levels;

2. **One continuous dependent variable** at the interval or ratio level;

3. **Independence of observations**, or a between-groups design, in which participants are separated into distinct groups with no overlap;

**Tested Assumptions**

4. **No significant outliers**, assessed with boxplots;

5. **Normality**, assessed with the Shapiro-Wilk test, histograms, and density curves for each combination of the two factors;

6. **Homoscedasticity**, assessed with Levene's test for each combination of the two factors.

An analysis of variance is robust. It can provide valid results with minor violations of normality. Since the first three assumptions are met during experimental design, we must test for outliers, normality, and homogeneity of variances.

The null and alternative hypotheses, assessed with the *F* test, can make claims about the means between cells or claims about the interaction between factors. For this study, they are:

$$H_0: \text{there is no interaction between orientation and station} \\ H_1: \text{there is an interaction}$$

Maglio and Polman (2014) conducted a 2 x 4 between-groups factorial experiment. The first factor, `direction`, has two levels: eastbound and westbound. The second factor, `station`, has four levels: Spadina, St. George, Bloor-Yonge, and Sherbourne. Thus, the sample of participants is divided into eight groups.

### Two-way ANOVA {.tabset .tabset-pills}
Since we have an unbalanced design with unequal sample sizes in each cell, we must specify the type of *sum of squares*. Type-III is usually [recommended](http://www.sthda.com/english/wiki/two-way-anova-test-in-r). When the design in unbalanced, each type of *sum of squares* will yield different results.

With that in mind, let's start by constructing the analysis of variance.

```{r}
maglio_aov <- aov(subjective_distance ~ orientation * station, data = maglio_clean)
```

Now we summarize the model to test for interaction effects. Note that we *must* include the `options()` call **first** since the sum of squares is Type III. Failure to do so will produce a correct effect with the interaction, but spurious effects for each factor by itself. In this case, failure to set `options()` will cause all effects to appear significant.

```{r}
options(contrasts = c("contr.sum", "contr.poly"))
(maglio_anova <- Anova(maglio_aov, type = "III"))
```

There are two significant effects, one on station and the other on the interaction between orientation and station. Therefore, we should assess the effect size, or partial eta-squared. This is given by the equation:

$$\eta_p^2 = \frac{SS_{predictor}}{SS_{predictor} + SS_{residuals}}$$

We can use `broom::tidy` to sweep the model's output into a tidy data frame. This will prevent entry errors and promote exact calculations.

```{r}
(maglio_tidy <- tidy(maglio_anova))
```

Now, calculating the effect size is a simple plug-in procedure.

```{r}
(eta_station <- maglio_tidy$sumsq[3] / (maglio_tidy$sumsq[3] + maglio_tidy$sumsq[5]))
(eta_interact <- maglio_tidy$sumsq[4] / (maglio_tidy$sumsq[4] + maglio_tidy$sumsq[5]))
```

The two-way ANOVA revealed no main effect on orientaion, *F* < 1, *p* = .573. The *F*-value did not exceed the critical value. However, there was a significant effect on station, *F*(3, 194) = 24.10, *p* < .001, $\eta_p^2 = .27$. The interaction between orientation and station was also significant, *F*(3, 194) = 16.28, *p* < .001, $\eta_p^2 = .20$.

#### Outliers?

#### Normality?

#### Homoscedasticity?

## Communicate
___
The two-way ANOVA revealed no main effect on orientaion, *F* < 1, *p* = .573. The *F*-value did not exceed the critical value. However, there was a significant effect on station, *F*(3, 194) = 24.10, *p* < .001, $\eta_p^2 = .27$. The interaction between orientation and station was also significant, *F*(3, 194) = 16.28, *p* < .001, $\eta_p^2 = .20$.

# Acknowledgements
___
I am thankful for my advisor, Dr. Brandt A. Smith for introducing me to R, JASP, and OSL. The discipline of psychology is advocating for preregistered, open materials. His encouragement to utilize open data and open source software has positioned me in the middle of the reproducible movement.

I would still be clicking checkboxes and dropdowns to analyze data if it were not for [DataCamp](https://www.datacamp.com), [Rose Maier](https://rstudio-pubs-static.s3.amazonaws.com/65059_586f394d8eb84f84b1baaf56ffb6b47f.html), [Alboukadel Kassambara](http://www.sthda.com/english/wiki/two-way-anova-test-in-r), [Jonathan Baron](https://www.sas.upenn.edu/~baron/from_cattell/rpsych/rpsych.html#htoc60), and the team behind [personality-project](http://personality-project.org/r/r.guide.html#withinone).

## Dependencies
This analysis was performed using the RStudio IDE.

```{r}
devtools::session_info()
```